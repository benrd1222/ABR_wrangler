?list.dirs
list.dirs(".")
# that the number of ABR and DP files present in the subdirectory matches the
# expected amount listed in "Experiment State.txt"
projDir <- "./Data" #TODO: think about how to run this script for a user- snakemake could be easy
samples <- list.dirs(path=projDir)
samples
list.dirs(path=projDir,all.files=FALSE)
list.dirs(path=projDir)
# that the number of ABR and DP files present in the subdirectory matches the
# expected amount listed in "Experiment State.txt"
projDir <- "./Data/" #TODO: think about how to run this script for a user- snakemake could be easy
list.dirs(path=projDir)
grepl(projDir,list.dirs(path=projDir))
grep(projDir,list.dirs(path=projDir))
grepl(projDir,list.dirs(path=projDir))
list.dirs(path=projDir,full.names = FALSE)
samples <- list.dirs(path=projDir)
samples <- samples[-1]
samples <- list.dirs(path=projDir,full.names = FALSE)
samples <- samples[-1]
# Load Libraries ----
library(tidyverse)
?str_glue
list.files(tidyverse::str_glue("{projDir}/{sample[1]}"))
list.files(stringr::str_glue("{projDir}/{sample[1]}"))
list.files(stringr::str_glue("{projDir}/{samples[1]}"))
?list.files
list.files(stringr::str_glue("{projDir}/{samples[1]}"),pattern = "^ABR.*.txt$")
ABR_wave_fp <- list.files(stringr::str_glue("{projDir}/{samples[1]}"),pattern = "^ABR.*d$")
ABR_wave_fp <- list.files(stringr::str_glue("{projDir}/{samples[1]}"),pattern = "^ABR.*d\$")
ABR_wave_fp <- list.files(stringr::str_glue("{projDir}/{samples[1]}"),pattern = "^ABR.*\d$")
ABR_analyzed_fp <- list.files(stringr::str_glue("{projDir}/{samples[1]}"),pattern = "^{ABR}.*.txt$")
ABR_analyzed_fp <- list.files(stringr::str_glue("{projDir}/{samples[1]}"),pattern = "^ABR\.txt$")
ABR_analyzed_fp <- list.files(stringr::str_glue("{projDir}/{samples[1]}"),pattern = "^ABR\\.txt$")
list.files(stringr::str_glue("{projDir}/{samples[1]}"),pattern = "^ABR\\.txt$")
list.files(stringr::str_glue("{projDir}/{samples[1]}"),pattern = "^ABR.\\.txt$")
list.files(stringr::str_glue("{projDir}/{samples[1]}"),pattern = "^ABR.*\\.txt$")
ABR_analyzed_fp <- list.files(
stringr::str_glue("{projDir}/{samples[1]}"),
pattern = "^ABR.*\\.txt$"
)
ABR_analyzed_fp <- list.files(
stringr::str_glue("{projDir}/{samples[1]}"),
pattern = "^ABR.*\\d$"
)
list.files(
stringr::str_glue("{projDir}/{samples[1]}"),
pattern = "^ABR.*\\d$"
)
ABR_analyzed_fp <- list.files(
stringr::str_glue("{projDir}/{samples[1]}"),
pattern = "^ABR.*\\d$"
)
list.files(
stringr::str_glue("{projDir}/{samples[1]}"),
pattern = "^ABR.*\\d$"
)
ABR_wave_fp <- list.files(
stringr::str_glue("{projDir}/{samples[1]}"),
pattern = "^ABR.*\\d$"
)
ABR_analyzed_fp <- list.files(
stringr::str_glue("{projDir}/{samples[1]}"),
pattern = "^ABR.*\\.txt$"
)
DP_analyzed_fp <- list.files(
stringr::str_glue("{projDir}/{samples[1]}"),
pattern = "^DP.*\\.txt$"
)
DP_wave_fp <- list.files(
stringr::str_glue("{projDir}/{samples[1]}"),
pattern = "^DP.*\\d$"
)
DP_wave_fp <- DP_wave_fp[1]
stdout("hi")
?stdout
?stderr
message(str_glue("Found all samples: {samples}"))
message(str_glue("Found all samples: "))
message(str_glue("{samples}"))
message(str_glue("{samples}",sep=", "))
?str_glue
message(str_glue("{samples}",.sep=", "))
message(str_glue("{samples}",.sep=" "))
str_glue("{samples}",.sep=" ")
# that the number of ABR and DP files present in the subdirectory matches the
# expected amount listed in "Experiment State.txt"
projDir <- "./Data" #TODO: think about how to run this script for a user- snakemake could be easy
message("Finding samples...")
samples <- list.dirs(path = projDir, full.names = FALSE)
samples <- samples[-1] # may not need if we call this within the project directory
ABR_analyzed_fp <- list.files(
stringr::str_glue("{projDir}/{samples[1]}"),
pattern = "^ABR.*\\.txt$"
)
ABR_wave_fp <- list.files(
stringr::str_glue("{projDir}/{samples[1]}"),
pattern = "^ABR.*\\d$"
)
DP_analyzed_fp <- list.files(
stringr::str_glue("{projDir}/{samples[1]}"),
pattern = "^DP.*\\.txt$"
)
DP_wave_fp <- list.files(
stringr::str_glue("{projDir}/{samples[1]}"),
pattern = "^DP.*\\d$"
)
DP_wave_fp <- DP_wave_fp[1]
message(str_glue("Found all samples: "))
message(str_glue("{samples}", .sep = " "))
# now we can validate that the files expected to be here have been found
readLines(str_glue("{projDir}/{samples[1]}/Experiment State.txt"))
?readLines
# now we can validate that the files expected to be here have been found
raw_experiment <- readLines(str_glue("{projDir}/{samples[1]}/Experiment State.txt"))
raw_experiment[3]
num_ABRs <- str_extract_all(raw_experiment[3], "[0-9]+")
num_DPs <- str_extract_all(raw_experiment[4], "[0-9]+")
View(num_DPs)
?str_extract_all
num_ABRs <- str_extract(raw_experiment[3], "[0-9]+")
num_DPs <- str_extract(raw_experiment[4], "[0-9]+")
num_ABRs <- as.numeric(str_extract(raw_experiment[3], "[0-9]+"))
num_DPs <- as.numeric(str_extract(raw_experiment[4], "[0-9]+"))
if(num_ABRs != length(ABR_analyzed_fp) || num_DPs != length(DP_analyzed_fp))
{}
?message
ABR_wave_fp <- list.files(
str_glue("{projDir}/{samples[1]}"),
pattern = "^ABR.*\\d$"
)
DP_analyzed_fp <- list.files(
str_glue("{projDir}/{samples[1]}"),
pattern = "^DP.*\\.txt$"
)
DP_wave_fp <- list.files(
str_glue("{projDir}/{samples[1]}"),
pattern = "^DP.*\\d$"
)
DP_wave_fp <- DP_wave_fp[1]
message(str_glue("Found all samples: "))
message(str_glue("{samples}", .sep = " "))
# now we can validate that the files expected to be here have been found
raw_experiment <- readLines(str_glue(
"{projDir}/{samples[1]}/Experiment State.txt"
))
num_ABRs <- as.numeric(str_extract(raw_experiment[3], "[0-9]+"))
num_DPs <- as.numeric(str_extract(raw_experiment[4], "[0-9]+"))
if (num_ABRs != length(ABR_analyzed_fp) || num_DPs != length(DP_analyzed_fp)) {
stop("The wrangler did not find the expected number of ABR or DP files")
}
num_ABRs=2
if (num_ABRs != length(ABR_analyzed_fp) || num_DPs != length(DP_analyzed_fp)) {
stop("The wrangler did not find the expected number of ABR or DP files")
}
num_ABRs <- as.numeric(str_extract(raw_experiment[3], "[0-9]+"))
num_DPs <- as.numeric(str_extract(raw_experiment[4], "[0-9]+"))
if (num_ABRs != length(ABR_analyzed_fp) || num_DPs != length(DP_analyzed_fp)) {
stop("The wrangler did not find the expected number of ABR or DP files")
}
readLines(str_glue("{projDir}/{ABR_analyzed_fp}"))
readLines(str_glue("{projDir}/{ABR_analyzed_fp}"),n=5)
str_glue("{projDir}/{ABR_analyzed_fp}")
readLines(str_glue("{projDir}/{ABR_analyzed_fp[1]}"),n=5)
cur_sample <- {projDir}/{samples[1]}
cur_sample <- str_glue("{projDir}/{samples[1]}")
cur_sample <- str_glue("{projDir}/{samples[1]}")
ABR_analyzed_fp <- list.files(
cur_sample,
pattern = "^ABR.*\\.txt$"
)
cur_sample <- str_glue("{projDir}/{samples[1]}")
ABR_analyzed_fp <- list.files(
cur_sample,
pattern = "^ABR.*\\.txt$"
)
ABR_wave_fp <- list.files(
cur_sample,
pattern = "^ABR.*\\d$"
)
DP_analyzed_fp <- list.files(
cur_sample,
pattern = "^DP.*\\.txt$"
)
DP_wave_fp <- list.files(
cur_sample,
pattern = "^DP.*\\d$"
)
DP_wave_fp <- DP_wave_fp[1]
readLines(str_glue("{projDir}/{ABR_analyzed_fp[1]}"),n=5)
readLines(str_glue("{cur_sample}/{ABR_analyzed_fp[1]}"),n=5)
readLines(str_glue("{cur_sample}/{ABR_analyzed_fp[1]}"),n=6)
readLines(str_glue("{cur_sample}/{ABR_analyzed_fp[1]}"),n=7)
readLines(str_glue("{cur_sample}/{ABR_analyzed_fp[1]}"),n=8)
readLines(str_glue("{cur_sample}/{ABR_analyzed_fp[1]}"),n=6)
# for each frequency
cur_file <- str_glue("{cur_sample}/{ABR_analyzed_fp[1]}")
header <- readLines(cur_file,n=6)
header
# Read the data as a tsv skipping the header
data <- read_delim(cur_file, sep = "\t", skip = 6)
?read_delim
# Read the data as a tsv skipping the header
data <- read_delim(cur_file, delim = "\t", skip = 6)
View(data)
cur_file
data <- read.delim(cur_file, sep = "\t", skip = 6)
View(data)
# Read the data as a tsv skipping the header
data <- read_delim(cur_file, delim = "\t", skip = 6) # for some reason the readr version misses the last line
cur_file <- str_glue("{cur_sample}/{ABR_wave_fp[1]}")
cur_filke
cur_file
readLines(cur_file,n=6)
readLines(cur_file,n=10)
header
header <- readLines(cur_file,n=7)
header[6]
data <- read.delim(cur_file, sep = "\t", skip = 7)
read.delim()
?read.delim
data <- read.delim(cur_file, sep = "\t", skip = 7, col.names = FALSE)
# Extract the levels from the header at header[6] with some str_extract_all call
levels <- str_extract_all(header,"[0-9]+")
levels
# Extract the levels from the header at header[6] with some str_extract_all call
levels <- str_extract_all(header[7],"[0-9]+")
levels
# Extract the levels from the header at header[6] with some str_extract_all call
levels <- str_extract_all(header[6],"[0-9]+")
levels
# Extract the levels from the header at header[6] with some str_extract_all call
levels <- str_extract(header[6],"[0-9]+")
levels
# Extract the levels from the header at header[6] with some str_extract_all call
levels <- unlist(str_extract_all(header[6],"[0-9]+"))
levels
data <- read.delim(cur_file, sep = "\t", skip = 7, col.names = levels)
levels
data <- read_delim(cur_file, sep = "\t", skip = 7, col.names = levels)
?read_delim()
data <- read_delim(cur_file, delim = "\t", skip = 7, col.names = levels)
data <- read_delim(cur_file, delim = "\t", skip = 7, col_names = FALSE)
colnames(data) <- levels
cur_file <- str_glue("{cur_sample}/{ABR_analyzed_fp[1]}")
header <- readLines(cur_file,n=6)
header
#extract info about frequency and threshold from the header
freq <- str_extract(header[2],"\\d+\\.\\d+")
freq
threshold <- str_extract(header[1],"\\d+\\.\\d+")
threshold
cur_file <- str_glue("{cur_sample}/{DP_analyzed_fp[1]}")
header <- readLines(cur_file,n=6)
header
# Read the data as a tsv skipping the header
data <- read_delim(cur_file, sep = "\t")
# Read the data as a tsv skipping the header
data <- read_delim(cur_file, delim = "\t")
cur_file <- str_glue("{cur_sample}/{DP_wave_fp[1]}")
data <- read_delim(cur_file, delim = "\t")
header <- readLines(cur_file,n=10)
header
data <- read_delim(cur_file, delim = "\t", skip = 7)
data <- read_delim(cur_file, delim = "\t", skip = 6)
header <- readLines(cur_sample,n=7)
header
header6
header[6]
# Header row 6 is the colnames, but rows 1-5 and row 7 are not needed so, we need
# to read all the lines as data first then subset then read the data as a delim
data <- readLines(cur_file)
data <- data[-c(1:5,7),]
data
data <- data[-c(1:5,7)]
data
data[1]
data <- read_delim(data, delim = "\t")
data <- read_delim(I(data), delim = "\t")
